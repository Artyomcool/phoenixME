<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html><head>

           
 

 <style type="text/css"> 
<!-- /* <![CDATA[ */
@import "/branding/css/tigris.css";
@import "/inst.css"; 
 

 /* ]]> */
 --> 

 </style>
 <link rel="stylesheet" type="text/css" href="how-to2_files/print.html" media="print">
 <script src="how-to2_files/tigris.html" type="text/javascript"></script>
 <!-- ------- ORIGINAL CODE --------------------------- -->
 <!--<head>
 <style type="text/css"> 
 /* <![CDATA[ */
 @import "/branding/css/tigris.css";
 @import "/branding/css/inst.css";
 /* ]]> */
 </style>
 <link rel="stylesheet" type="text/css" href="/branding/css/print.css" media="print" />
 <script src="/branding/scripts/tigris.js" type="text/javascript"></script> -->


  
                                                     <title>Getting Started: Cobalt/MIPS Target Device Notes</title>
 <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
 <meta http-equiv="Content-Style-Type" content="text/css" />
 <meta name="version" content="3.5.1.19.8" />
 <style type="text/css">
<!--
a:link {
	text-decoration: none;
}
a:visited {
	text-decoration: none;
}
a:hover {
	text-decoration: underline;
}
a:active {
	text-decoration: none;
}
-->
</style></head>
 
 
<body  class="composite">
  
<table border="0" cellspacing="0" cellpadding="4" width="100%" id="main">
<tr>
 <td id="midcol">
 
 
<!-- 
 ===============================================================================
    IGNORE EVERYTHING ABOVE THIS AREA.  *   START EDITING BELOW 
 ===============================================================================
 -->
 
 
 
<!--BEGIN * PAGE TITLE -->
<div id="projecthome" class="app"> 
<h1><font color="#E76F00">Cobalt/MIPS Target Device Notes</font></h1>
<!--END * PAGE TITLE -->
<p>
<b>TODO: Qt setup</b>
</p><p>
<hr size="1" noshade>
<a name="DeviceDescription"><h2>Device Description</h2></a>
</p><p>
The <a href="http://www.linux-mips.org/wiki/Cobalt">Cobalt Qube 2</a>
is a MIPS-based network server built between 1998 and 2001.
The Qube 2 is an all-purpose server device
useful for testing CDC on the MIPS architecture
in both headless and GUI-based scenarios.
The <a href="http://www.linux-mips.org/">Linux-MIPS</a> project
is a Linux distribution for the MIPS architecture
which supports the Cobalt Qube 2 server.

<a name="DeviceFeatures"><h3>Hardware Features</h3></a>
</p><p>
See the
<a href="http://www.linux-mips.org/wiki/Cobalt">Cobalt Wiki</a>.

<a name="DeviceSoftware"><h3>Required Software</h3></a>
</p><p>
See the
<a href="http://www.linux-mips.org/wiki/Cobalt#Running_Linux">Cobalt Wiki</a>.

<hr size="1" noshade>
<a name="DeviceSourceCode"><h2>Source Code Layout</h2></a>
</p><p>
The device-dependent directories in the build system and source trees are:
</p><p>
</p><ul>
<li>
<tt>build/linux-mips-cobalt</tt>
<p>
</p></li><li>
<tt>build/linux-mips</tt>
<p>
</p></li><li>
<tt>build/mips</tt>
<p>
</p></li><li>
<tt>src/linux-mips</tt>
<p>
</p></li><li>
<tt>src/mips</tt>
</li></ul>
<p>
See the <i>CDC Porting Guide</i> and <i>CDC Build System Guide</i>
for more information about the organization and contents
of the source code and build system.

<hr size="1" noshade>
<a name="DeviceBuildTools"><h2>Target Build Tools</h2></a>
</p><p>
Building a GNU-based cross-compiler tools
for an alternate Linux platform is complex.
The notes below give an outline of how to proceed for a Linux/MIPS platform.
You should also read the
<a href="http://gcc.gnu.org/install">GCC documentation</a>.
</p><p>
</p><ol>
<li>
<b>Create a directory to hold the cross-compiler tools.</b>
<p>
</p><blockquote>
<pre>% mkdir /usr/mipstools
</pre>
</blockquote>
<p>
</p></li><li>
<b>Get <tt>lib/</tt> and <tt>sys-include/</tt> directories
for the target platform.</b>
This procedure requires a fair amount of knowledge about the target platform.
<p>
</p><ol type="a">
<li>
<b>Create directories for the libraries and include files.</b>
<p>
</p><pre>% mkdir /usr/mipstools/mipsel-linux/include
% mkdir /usr/mipstools/mipsel-linux/lib
</pre>
<p>
</p></li><li>
<b>Bundle the <tt>/usr/lib</tt>, <tt>/usr/include</tt> and <tt>/lib</tt>
directories from the target platform into an archive file,
with soft links are preserved.</b>
<p>
</p></li><li>
<b>Unbundle the archive file onto the development host system.</b>
<p>
</p></li><li>
<b>Combine the <tt>usr/lib</tt> and <tt>lib</tt> directories
into a single <tt>lib</tt> directory.</b>
<p>
</p></li><li>
<b>In the <tt>lib</tt> directory,
fix all the soft links that refer to absolute path in <tt>/lib</tt>
to instead reference the file in the current directory.</b>
<p>
</p></li><li>
<b>Edit <tt>lib/libc.so</tt> so that absolute paths are no longer used
to reference <tt>libc.so.6</tt> and <tt>libc_nonshared.a</tt>
since they are now in the same directory.</b>
<p>
</p></li><li>
<b>Move the contents of <tt>lib</tt> and <tt>sys-include</tt> directories
to the directory created above.</b>
</li></ol>
<p>
</p></li><li>
<b>Identify the bootstrap compiler.</b>
<p>
</p><blockquote>
<pre>$ export CC=/usr/bin/gcc-3.4        # Bourne-shell

&nbsp;&nbsp;<i>or</i>

% setenv CC /usr/bin/gcc-3.4        # C shell
</pre>
</blockquote>
<p>
</p></li><li>
<b>Build <tt>binutils</tt> for the target platform.</b>
<p>
</p><ol type="a">
<li>
<b>Download <tt>binutils</tt>.</b>
<p>
</p></li><li>
<b>Configure <tt>binutils</tt>.</b>
<p>
</p><pre>% configure \
  --prefix=/usr/mipstools \
  --host=i686-lsb-linux \
  --target=mipsel-linux \
  --with-cpu=mipsel \
  --enable-languages=c,c++
</pre>
<p>
</p></li><li>
<b>Build <tt>binutils</tt>.</b>
<p>
</p><pre>% make
</pre>
<p>
</p></li><li>
<b>Install <tt>binutils</tt>.</b>
<p>
</p><pre>% make install
</pre>
<p>
</p></li></ol>
</li><li>
<b>Build <tt>gcc</tt> for the target platform.</b>
<p>
</p><ol type="a">
<li>
<b>Download <tt>gcc</tt>.</b>
<p>
</p></li><li>
<b>Configure <tt>gcc</tt>.</b>
<p>
</p><pre>% configure \
  --prefix=/usr/mipstools \
  --host=i686-lsb-linux \
  --target=mipsel-linux \
  --with-gnu-as \
  --with-gnu-ld \
  --with-as=/usr/mipstools/mipsel-linux/bin/as \
  --with-ld=/usr/mipstools/mipsel-linux/bin/ld \
  --with-headers=/usr/mipstools/include \
  --with-libs=/usr/mipstools/libs \
  --disable-nls \
  --enable-languages=c,c++
</pre>
<p>
</p></li><li>
<b>Build <tt>gcc</tt>.</b>
<p>
</p><pre>% make
</pre>
<p>
</p></li><li>
<b>Install <tt>gcc</tt>.</b>
<p>
</p><pre>% make install
</pre>
</li></ol>
</li></ol>
<p>
Once these tools are built and installed,
you should test them with a simple <tt>HelloWorld.c</tt>
program before integrating them into the CDC build system.

<hr size="1" noshade>
<a name="DeviceProcedures"><h2>Build System Procedures</h2></a>
</p><p>
After building the MIPS target toolchain,
configuring the CDC build system to use these tools is straightforward.
The procedures for setup, building and testing are very similar
to the procedures for host-based systems.

<a name="DeviceSetup"><h3>Setup the Build System</h3></a>
</p><p>
<b>Insert the following variable definitions
into the <tt>GNUmakefile</tt> in the target build directory.</b>
These <tt>make</tt> variables define the locations of each build tool.
The shared variables <tt>MY_HOST_TOOLS</tt>, <tt>MY_TARGET_TOOLS</tt> and <tt>MY_JAVA_TOOLS</tt>
may need different values to specify the location of these tools on your system.
</p><p>
</p><blockquote>
<pre>#
# Locate the host build tools:
#
MY_HOST_TOOLS = /usr/bin
HOST_CC             = $(MY_HOST_TOOLS)/gcc-3.4
HOST_CCC            = $(MY_HOST_TOOLS)/g++-3.4
ZIP                 = $(MY_HOST_TOOLS)/zip

#
# Locate the target build tools:
#
MY_TARGET_TOOLS = /usr/mipstools/bin
TARGET_CC           = $(MY_TARGET_TOOLS)/gcc
TARGET_CCC          = $(MY_TARGET_TOOLS)/g++
TARGET_AS           = $(TARGET_CC)
TARGET_LD           = $(TARGET_CC)
TARGET_AR           = $(MY_TARGET_TOOLS)/ar
TARGET_RANLIB       = $(MY_TARGET_TOOLS)/ranlib
BISON               = $(MY_HOST_TOOLS)/bison
FLEX                = $(MY_HOST_TOOLS)/flex

#
# Locate the JDK build tools:
#
MY_JAVA_TOOLS = /usr/java/j2sdk/bin
CVM_JAVA            = $(MY_JAVA_TOOLS)/java
CVM_JAVAC           = $(MY_JAVA_TOOLS)/javac
CVM_JAVAH           = $(MY_JAVA_TOOLS)/javah
CVM_JAR             = $(MY_JAVA_TOOLS)/jar
</pre>
</blockquote>
<p>
Note that on most systems,
the GCC excutable is named <tt>gcc</tt>,
but on systems like Ubuntu,
the excutable name may include a version number.
</p><p>
You may also want to add other build options 
for API, testing or performance options.

<a name="DeviceBuild"><h3>Build the Executable</h3></a>
</p><p>
</p><blockquote>
<pre>% make
</pre>
</blockquote>

<a name="DeviceBundle"><h3>Bundle the Executable</h3></a>
<p>
</p><blockquote>
<pre>% make bin
</pre>
</blockquote>
<p>
After the bundle is built,
it is located in <tt>../../install</tt>.

<a name="DeviceDownload"><h3>Download the Executable</h3></a>
</p><p>
</p><blockquote>
<pre>% sftp <i>target-system</i>
</pre>
</blockquote>

<a name="DeviceTest"><h3>Test the Executable</h3></a>
<p>
</p><blockquote>
<pre>% bin/cvm -cp testclasses.zip cdc.HelloWorld
</pre>
</blockquote>
</body></html>